{
  "name": "main",
  "flagNames": [
    "hasKey",
    "hasTorch",
    "hasMap",
    "doorUnlocked",
    "torchLit",
    "metOldMan",
    "heardRumor",
    "solvedPuzzle",
    "foughtBoss",
    "wasHighScore",
    "secretFound",
    "badEnding"
  ],
  "pageNames": [
    "start",
    "entrance",
    "outside_investigation",
    "left_room",
    "right_room",
    "upstairs",
    "outside_check",
    "give_up_ending",
    "talk_to_old_man",
    "examine_books",
    "old_man_story",
    "red_book",
    "blue_book",
    "green_book",
    "yellow_book",
    "black_book",
    "time_ran_out",
    "light_torch",
    "open_chest",
    "locked_door",
    "basement_entrance",
    "basement",
    "dark_basement",
    "bad_ending_fall",
    "wrong_lever_1",
    "correct_lever",
    "wrong_lever_2",
    "boss_room",
    "boss_fight",
    "final_room",
    "boss_attack",
    "boss_defend",
    "boss_timeout",
    "bad_ending_timeout",
    "secret_room",
    "take_treasure",
    "true_ending",
    "normal_ending"
  ],
  "pages": {
    "start": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "title_screen"
          }
        ]
      },
      {
        "type": "exec",
        "func": "PLAY_BGM",
        "args": [
          {
            "type": "text",
            "value": "opening_theme"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "古びた洋館の前に立つあなた。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "雨が降りしきる中、不気味な雰囲気が漂っている。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "扉は半開きで、中から微かな光が漏れている。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "洋館に入る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "entrance",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "周囲を調べる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "outside_investigation",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "outside_investigation": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "mansion_outside"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "洋館の周りを調べてみる。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [
          {
            "formula": "false",
            "flags": ["hasMap"]
          }
        ],
        "text": "地面に古びた地図が落ちている。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [
          {
            "formula": "false",
            "flags": ["hasTorch"]
          }
        ],
        "text": "壁際に松明が立てかけてある。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "or:$hasMap,$hasTorch"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "地図を拾う",
            "wasCancel": false,
            "wasTimeup": false,
            "page": null,
            "noMove": true,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["hasMap"]
              }
            ],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["hasMap"]
              }
            ]
          },
          {
            "text": "松明を拾う",
            "wasCancel": false,
            "wasTimeup": false,
            "page": null,
            "noMove": true,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["hasTorch"]
              }
            ],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["hasTorch"]
              }
            ]
          },
          {
            "text": "洋館に入る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "entrance",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "entrance": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "entrance_hall"
          }
        ]
      },
      {
        "type": "exec",
        "func": "STOP_BGM",
        "args": []
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "door_creak"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "洋館のエントランスホール。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "埃まみれのシャンデリアが天井から吊るされている。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "左右に扉があり、正面には大きな階段がある。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "左の扉を開ける",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "left_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "右の扉を開ける",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "right_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "階段を上る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "upstairs",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "外に戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "outside_check",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "outside_check": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "本当に外に出るのか？"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "まだ何も調べていないが..."
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "やはり中を調べる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": null,
            "noMove": false,
            "toBack": true,
            "conditions": [],
            "effects": []
          },
          {
            "text": "外に出る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "give_up_ending",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "left_room": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "library"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "図書室のような部屋。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "古い本が所狭しと並んでいる。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "false",
            "flags": ["metOldMan"]
          }
        ],
        "text": "部屋の奥に老人が座っている。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "true",
            "flags": ["metOldMan"]
          }
        ],
        "text": "老人はもういない。本だけが残されている。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "老人に話しかける",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "talk_to_old_man",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["metOldMan"]
              }
            ],
            "effects": []
          },
          {
            "text": "本を調べる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "examine_books",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "エントランスに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "entrance",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "talk_to_old_man": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "old_man_voice"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "老人「よく来たな。この洋館の秘密を知りたいか？」"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "話を聞く",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "old_man_story",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["metOldMan", "o-true"]
              }
            ]
          },
          {
            "text": "無視して去る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "left_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["metOldMan"]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "old_man_story": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "mode",
            "flags": ["utorial"]
          }
        ],
        "text": "老人「チュートリアルモードだな。詳しく説明しよう。」"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "mode",
            "flags": ["ot"]
          }
        ],
        "text": "老人「この洋館には古い呪いがかかっている。」"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "老人「地下には秘密の部屋がある。」"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "老人「鍵と松明があれば、そこに辿り着けるだろう。」"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "ありがとう",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "left_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "examine_books": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "本棚を調べる。どの本を読もう？"
      },
      {
        "type": "choice",
        "time": "long",
        "options": [
          {
            "text": "赤い本",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "red_book",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "青い本",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "blue_book",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "緑の本",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "green_book",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "黄色い本",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "yellow_book",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "黒い本",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "black_book",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": null,
            "wasCancel": true,
            "wasTimeup": false,
            "page": "left_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": null,
            "wasCancel": false,
            "wasTimeup": true,
            "page": "time_ran_out",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "red_book": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "赤い本「火の魔法について」"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "松明に火を灯す呪文が書かれている。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "呪文を唱える",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "light_torch",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["torchLit"]
              },
              {
                "formula": "true",
                "flags": ["hasTorch"]
              }
            ],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["torchLit"]
              }
            ]
          },
          {
            "text": "本を閉じる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "examine_books",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "blue_book": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "青い本「水の精霊の伝説」"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "特に役立つ情報はなかった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "examine_books",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "green_book": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "緑い本「洋館の歴史」"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "この洋館は100年前に建てられたらしい。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "examine_books",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "yellow_book": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "黄色い本「錬金術入門」"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "難解な内容で理解できなかった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "examine_books",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "black_book": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "黒い本「禁断の儀式」"
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "ominous_sound"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "読んではいけないものを読んでしまった気がする..."
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "急いで本を閉じる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "examine_books",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["badEnding"]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "time_ran_out": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "考えているうちに時間が経ちすぎてしまった。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "何かの気配を感じて、慌てて本棚から離れる。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "left_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "light_torch": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "fire_ignite"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "呪文を唱えると、松明に火が灯った！"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "left_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "right_room": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "treasure_room"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "宝物室のような部屋。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "中央に鍵のかかった宝箱がある。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [
          {
            "formula": "false",
            "flags": ["hasKey"]
          }
        ],
        "text": "壁に古びた鍵が掛かっている。"
      },
      null,
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "鍵を取る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": null,
            "noMove": true,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["hasKey"]
              }
            ],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["hasKey"]
              }
            ]
          },
          {
            "text": "宝箱を開ける",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "open_chest",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "true",
                "flags": ["hasKey"]
              },
              {
                "formula": "false",
                "flags": ["doorUnlocked"]
              }
            ],
            "effects": []
          },
          {
            "text": "エントランスに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "entrance",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "open_chest": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "chest_open"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "宝箱を開けた！"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "中には古い日記が入っていた。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "日記「地下室への扉は2階にある」"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "日記を読み終える",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "right_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["doorUnlocked"]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "upstairs": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "upstairs_hall"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "2階の廊下。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "長い廊下の奥に扉が見える。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "or:$hasKey,$hasTorch"
      },
      null,
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "奥の扉を開ける",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "locked_door",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["doorUnlocked"]
              }
            ],
            "effects": []
          },
          {
            "text": "奥の扉を開ける",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "basement_entrance",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "true",
                "flags": ["doorUnlocked"]
              }
            ],
            "effects": []
          },
          {
            "text": "1階に戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "entrance",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "locked_door": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "扉には鍵穴があるが、開け方がわからない。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "何か情報が必要だ。"
      },
      {
        "type": "page-end",
        "mode": "back"
      }
    ],
    "basement_entrance": [
      {
        "type": "exec",
        "func": "STOP_BGM",
        "args": []
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "heavy_door"
          }
        ]
      },
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "basement_stairs"
          }
        ]
      },
      {
        "type": "exec",
        "func": "PLAY_BGM",
        "args": [
          {
            "type": "text",
            "value": "tension_theme"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "扉を開けると、地下へと続く階段が現れた。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "true",
            "flags": ["torchLit"]
          }
        ],
        "text": "松明の明かりが階段を照らす。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "false",
            "flags": ["torchLit"]
          }
        ],
        "text": "暗くて足元が見えない。危険だ。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "地下に降りる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "basement",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "true",
                "flags": ["torchLit"]
              }
            ],
            "effects": []
          },
          {
            "text": "地下に降りる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "dark_basement",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["torchLit"]
              }
            ],
            "effects": []
          },
          {
            "text": "やめて戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "upstairs",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "dark_basement": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "pitch_black"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "暗闇の中を進む..."
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "stumble"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "足を滑らせて転んでしまった！"
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "game_over"
          }
        ]
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "ゲームオーバー",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "bad_ending_fall",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "basement": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "basement"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "地下室。松明の明かりで周囲が見渡せる。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "部屋の中央に不思議な装置がある。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "装置には3つのレバーがついている。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "false",
            "flags": ["solvedPuzzle"]
          }
        ],
        "text": "どのレバーを引くべきか..."
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "true",
            "flags": ["solvedPuzzle"]
          }
        ],
        "text": "装置は既に作動している。奥への道が開いている。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "左のレバーを引く",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "wrong_lever_1",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["solvedPuzzle"]
              }
            ],
            "effects": []
          },
          {
            "text": "中央のレバーを引く",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "correct_lever",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["solvedPuzzle"]
              }
            ],
            "effects": []
          },
          {
            "text": "右のレバーを引く",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "wrong_lever_2",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["solvedPuzzle"]
              }
            ],
            "effects": []
          },
          {
            "text": "奥の部屋に進む",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "boss_room",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "true",
                "flags": ["solvedPuzzle"]
              }
            ],
            "effects": []
          },
          {
            "text": "奥の部屋に進む",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "upstairs",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "wrong_lever_1": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "wrong_buzzer"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "レバーを引いたが、何も起きなかった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "basement",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "wrong_lever_2": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "wrong_buzzer"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "レバーを引いたが、何も起きなかった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "basement",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "correct_lever": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "mechanism"
          }
        ]
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "door_unlock"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "レバーを引くと、装置が音を立てて動き出した！"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "奥の壁が開き、隠し部屋への道が現れた。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "進む",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "basement",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["solvedPuzzle"]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "boss_room": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "boss_room"
          }
        ]
      },
      {
        "type": "exec",
        "func": "STOP_BGM",
        "args": []
      },
      {
        "type": "exec",
        "func": "PLAY_BGM",
        "args": [
          {
            "type": "text",
            "value": "boss_theme"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "隠し部屋。部屋の中央に巨大な影が立っている。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "false",
            "flags": ["foughtBoss"]
          }
        ],
        "text": "影「よくここまで来たな。だが、ここで終わりだ！」"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "true",
            "flags": ["foughtBoss"]
          }
        ],
        "text": "倒れた影が横たわっている。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "戦う",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "boss_fight",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "false",
                "flags": ["foughtBoss"]
              }
            ],
            "effects": []
          },
          {
            "text": "奥に進む",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "final_room",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "true",
                "flags": ["foughtBoss"]
              }
            ],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "boss_fight": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "battle_start"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "mode",
            "flags": ["asy"]
          }
        ],
        "text": "影の攻撃は緩慢だ。簡単に避けられる。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "mode",
            "flags": ["ot"]
          }
        ],
        "text": "影の攻撃は素早い！慎重に戦わなければ。"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "戦闘開始！"
      },
      {
        "type": "choice",
        "time": "normal",
        "options": [
          {
            "text": "攻撃する",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "boss_attack",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": "防御する",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "boss_defend",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          },
          {
            "text": null,
            "wasCancel": false,
            "wasTimeup": true,
            "page": "boss_timeout",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "boss_attack": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "sword_slash"
          }
        ]
      },
      null,
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "渾身の一撃が影を貫いた！"
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "enemy_defeated"
          }
        ]
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "勝利した",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "boss_room",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["foughtBoss"]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "boss_defend": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "防御に専念した。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "しかし、守りに徹しているだけでは勝てない！"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "再び攻撃",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "boss_attack",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "boss_timeout": [
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "戦いが長引きすぎた！"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "体力が尽きてしまった..."
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "game_over"
          }
        ]
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "ゲームオーバー",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "bad_ending_timeout",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "final_room": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "final_room"
          }
        ]
      },
      {
        "type": "exec",
        "func": "STOP_BGM",
        "args": []
      },
      {
        "type": "exec",
        "func": "PLAY_BGM",
        "args": [
          {
            "type": "text",
            "value": "ending_theme"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "最奥の部屋。美しい宝石が台座に置かれている。"
      },
      null,
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "台座の周りを調べると、隠しスイッチを発見した！"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [
          {
            "formula": "false",
            "flags": ["hasMap"]
          }
        ],
        "text": "特に何も見つからない。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "隠しスイッチを押す",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "secret_room",
            "noMove": false,
            "toBack": false,
            "conditions": [
              {
                "formula": "true",
                "flags": ["hasMap", "rue"]
              }
            ],
            "effects": []
          },
          {
            "text": "宝石を取る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "take_treasure",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "secret_room": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "secret_found"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "隠し部屋が開いた！"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "中には伝説の秘宝が眠っていた！"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "秘宝を手に入れる",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "true_ending",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-true",
                "flags": ["secretFound"]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "take_treasure": [
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "item_get"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "宝石を手に入れた。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "洋館を出る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "normal_ending",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "true_ending": [
      {
        "type": "exec",
        "func": "STOP_BGM",
        "args": []
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "fanfare"
          }
        ]
      },
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "true_ending"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "秘宝を手に洋館を後にした。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "すべての謎を解き明かし、真の宝を手に入れた！"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "*** TRUE ENDING ***"
      },
      {
        "type": "exec",
        "func": "SAVE_CLEAR_TIME",
        "args": [
          {
            "type": "flag",
            "value": "wasHighScore"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "true",
            "flags": ["wasHighScore"]
          }
        ],
        "text": "クリアタイムハイスコア更新！"
      },
      {
        "type": "exec",
        "func": "UNLOCK_ACHIEVEMENT",
        "args": [
          {
            "type": "text",
            "value": "true_ending"
          }
        ]
      },
      {
        "type": "exec",
        "func": "ROLL_CREDITS",
        "args": []
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "タイトルに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "start",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-false",
                "flags": [
                  "hasKey",
                  "hasTorch",
                  "hasMap",
                  "doorUnlocked",
                  "torchLit",
                  "metOldMan",
                  "heardRumor",
                  "solvedPuzzle",
                  "foughtBoss",
                  "secretFound",
                  "badEnding"
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "normal_ending": [
      {
        "type": "exec",
        "func": "STOP_BGM",
        "args": []
      },
      {
        "type": "exec",
        "func": "PLAY_SE",
        "args": [
          {
            "type": "text",
            "value": "ending_jingle"
          }
        ]
      },
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "normal_ending"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "宝石を手に洋館を後にした。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "まだ見ぬ秘密があった気がするが..."
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "*** NORMAL ENDING ***"
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "true",
            "flags": ["badEnding"]
          }
        ],
        "text": "（黒い本を読んだことが頭から離れない...）"
      },
      {
        "type": "exec",
        "func": "SAVE_CLEAR_TIME",
        "args": [
          {
            "type": "flag",
            "value": "wasHighScore"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [
          {
            "formula": "false",
            "flags": ["wasHighScore"]
          }
        ],
        "text": "もっと早くクリアできたかもしれない。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "タイトルに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "start",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-false",
                "flags": [
                  "hasKey",
                  "hasTorch",
                  "hasMap",
                  "doorUnlocked",
                  "torchLit",
                  "metOldMan",
                  "heardRumor",
                  "solvedPuzzle",
                  "foughtBoss",
                  "secretFound",
                  "badEnding"
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "bad_ending_fall": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "game_over"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "暗闇で転倒し、意識を失った..."
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "*** BAD ENDING: 準備不足 ***"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "松明を灯してから来るべきだった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "タイトルに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "start",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-false",
                "flags": [
                  "hasKey",
                  "hasTorch",
                  "hasMap",
                  "doorUnlocked",
                  "torchLit",
                  "metOldMan",
                  "heardRumor",
                  "solvedPuzzle",
                  "foughtBoss",
                  "secretFound",
                  "badEnding"
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "bad_ending_timeout": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "game_over"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "力尽きて倒れてしまった..."
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "*** BAD ENDING: 戦闘敗北 ***"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "もっと効率的に戦うべきだった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "タイトルに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "start",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": [
              {
                "formula": "to-false",
                "flags": [
                  "hasKey",
                  "hasTorch",
                  "hasMap",
                  "doorUnlocked",
                  "torchLit",
                  "metOldMan",
                  "heardRumor",
                  "solvedPuzzle",
                  "foughtBoss",
                  "secretFound",
                  "badEnding"
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ],
    "give_up_ending": [
      {
        "type": "exec",
        "func": "SET_BG",
        "args": [
          {
            "type": "text",
            "value": "give_up"
          }
        ]
      },
      {
        "type": "line",
        "isFirst": true,
        "conditions": [],
        "text": "洋館を後にした。"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "*** BAD ENDING: 探索放棄 ***"
      },
      {
        "type": "line",
        "isFirst": false,
        "conditions": [],
        "text": "何も得られなかった。"
      },
      {
        "type": "choice",
        "time": null,
        "options": [
          {
            "text": "タイトルに戻る",
            "wasCancel": false,
            "wasTimeup": false,
            "page": "start",
            "noMove": false,
            "toBack": false,
            "conditions": [],
            "effects": []
          }
        ]
      },
      {
        "type": "page-end",
        "mode": "return"
      }
    ]
  }
}
